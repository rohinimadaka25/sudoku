<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sudoku Game</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 20px;
            width: 100%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 1.8em;
        }
        
        .timer {
            background: #6a11cb;
            color: white;
            padding: 10px 20px;
            border-radius: 50px;
            text-align: center;
            font-size: 1.4em;
            font-weight: bold;
            margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .button-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }
        
        .button-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
        }
        
        button {
            border: none;
            padding: 12px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            font-weight: 600;
            min-height: 50px;
        }
        
        #newBtn, #refreshBtn, #quitBtn {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
        }
        
        #clueBtn {
            background: linear-gradient(135deg, #ff7e5f 0%, #feb47b 100%);
            color: white;
        }
        
        #solveBtn {
            background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%);
            color: white;
        }
        
        select {
            padding: 12px;
            border-radius: 10px;
            border: 2px solid #6a11cb;
            font-size: 16px;
            width: 100%;
            text-align: center;
        }
        
        /* Sudoku Grid */
        .sudoku-container {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            grid-template-rows: repeat(9, 1fr);
            width: 100%;
            aspect-ratio: 1;
            margin-bottom: 20px;
            border: 3px solid #333;
            background: #333;
            gap: 1px;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .sudoku-cell {
            width: 100%;
            height: 100%;
            text-align: center;
            font-size: 1.4em;
            font-weight: bold;
            border: none;
            background: white;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            color: #333; /* Black for all user entries */
        }
        
        .sudoku-cell:focus {
            background: #e6f7ff;
            outline: none;
        }
        
        /* Remove number input spinners */
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        input[type="number"] {
            -moz-appearance: textfield;
        }
        
        /* Thick borders for 3x3 boxes */
        .sudoku-cell:nth-child(3n) {
            border-right: 3px solid #333 !important;
        }
        
        .sudoku-cell:nth-child(9n) {
            border-right: 1px solid #ccc !important;
        }
        
        /* Apply thick bottom borders to rows 3, 6 */
        .sudoku-cell:nth-child(n+19):nth-child(-n+27),
        .sudoku-cell:nth-child(n+46):nth-child(-n+54) {
            border-bottom: 3px solid #333 !important;
        }
        
        /* Regular borders */
        .sudoku-cell {
            border: 1px solid #ccc;
        }
        
        /* Cell colors - ONLY blue for given, orange for clues */
        .given {
            color: #6a11cb; /* Blue for given numbers */
            background-color: #f8f8ff;
            font-weight: bold;
        }
        
        .user {
            color: #333; /* Black for all user entries */
            font-weight: bold;
        }
        
        .clue {
            color: #f39c12; /* Orange for clues */
            background-color: #fff8e6;
            font-weight: bold;
        }
        
        /* Stats */
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .stat {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 10px;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #6a11cb;
        }
        
        /* Completion Message */
        .completion-message {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .message-box {
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 80%;
            animation: popup 0.3s ease-out;
        }
        
        @keyframes popup {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        .message-box h2 {
            color: #2ecc71;
            margin-bottom: 15px;
            font-size: 1.8em;
        }
        
        .message-box p {
            margin: 10px 0;
            color: #333;
        }
        
        .message-box .final-stats {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .message-box button {
            margin-top: 15px;
            padding: 12px 30px;
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 15px;
            }
            
            .sudoku-cell {
                font-size: 1.2em;
            }
            
            .button-row, .button-row-3 {
                grid-template-columns: 1fr;
            }
            
            button {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Sudoku Game</h1>
        <div class="timer">‚è±Ô∏è Time: <span id="timer">00:00</span></div>
        
        <div class="controls">
            <div class="button-row">
                <button id="newBtn">New Puzzle</button>
                <button id="clueBtn">Get Clue</button>
            </div>
            
            <select id="difficulty">
                <option value="easy">Easy (40+ clues)</option>
                <option value="medium" selected>Medium (30-35 clues)</option>
                <option value="hard">Hard (25-29 clues)</option>
                <option value="expert">Expert (20-24 clues)</option>
            </select>
            
            <div class="button-row-3">
                <button id="solveBtn">Show Solution</button>
                <button id="refreshBtn">Refresh Puzzle</button>
                <button id="quitBtn">Quit Game</button>
            </div>
        </div>
        
        <div class="sudoku-container" id="sudokuGrid"></div>
        
        <div class="stats">
            <div class="stat">
                <div class="stat-label">Difficulty</div>
                <div class="stat-value" id="difficultyStat">Medium</div>
            </div>
            <div class="stat">
                <div class="stat-label">Clues Used</div>
                <div class="stat-value" id="cluesStat">0</div>
            </div>
            <div class="stat">
                <div class="stat-label">Filled Cells</div>
                <div class="stat-value" id="filledStat">0/81</div>
            </div>
        </div>
    </div>

    <div class="completion-message" id="completionMessage">
        <div class="message-box">
            <h2>üéâ CONGRATULATIONS! üéâ</h2>
            <p>You solved the Sudoku puzzle correctly!</p>
            <div class="final-stats">
                <p>‚è±Ô∏è <strong>Final Time:</strong> <span id="finalTime">00:00</span></p>
                <p>üí° <strong>Clues Used:</strong> <span id="finalClues">0</span></p>
                <p>üéØ <strong>Difficulty:</strong> <span id="finalDifficulty">Medium</span></p>
            </div>
            <button id="playAgainBtn" style="background: #2ecc71; color: white;">Play Again</button>
        </div>
    </div>

    <script>
        class SudokuGame {
            constructor() {
                this.grid = Array(9).fill().map(() => Array(9).fill(0));
                this.solution = null;
                this.puzzle = null;
                this.userInput = Array(9).fill().map(() => Array(9).fill(0));
                this.timerSeconds = 0;
                this.timerInterval = null;
                this.cluesUsed = 0;
                this.isSolved = false;
                this.usedSolveButton = false;
                this.difficulties = {
                    easy: { min: 40, max: 45 },
                    medium: { min: 30, max: 35 },
                    hard: { min: 25, max: 29 },
                    expert: { min: 20, max: 24 }
                };
                
                this.init();
            }
            
            init() {
                this.generateNewPuzzle();
                this.setupEventListeners();
                this.startTimer();
            }
            
            generateNewPuzzle() {
                // Stop existing timer
                this.stopTimer();
                
                // Generate complete board
                this.generateCompleteBoard();
                this.solution = this.grid.map(row => [...row]);
                
                // Create puzzle by removing numbers
                const difficulty = document.getElementById('difficulty').value;
                const range = this.difficulties[difficulty];
                const keepCount = Math.floor(Math.random() * (range.max - range.min + 1)) + range.min;
                this.puzzle = this.solution.map(row => [...row]);
                
                // Remove numbers
                const positions = [];
                for (let i = 0; i < 9; i++) {
                    for (let j = 0; j < 9; j++) {
                        positions.push([i, j]);
                    }
                }
                
                // Shuffle positions
                for (let i = positions.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [positions[i], positions[j]] = [positions[j], positions[i]];
                }
                
                // Remove numbers except keepCount
                for (let i = keepCount; i < 81; i++) {
                    const [r, c] = positions[i];
                    this.puzzle[r][c] = 0;
                }
                
                this.userInput = this.puzzle.map(row => [...row]);
                this.renderGrid();
                this.updateStats();
                this.cluesUsed = 0;
                this.isSolved = false;
                this.usedSolveButton = false;
                document.getElementById('cluesStat').textContent = '0';
                
                // Reset and start timer
                this.timerSeconds = 0;
                this.updateTimerDisplay();
                this.startTimer();
            }
            
            generateCompleteBoard() {
                this.grid = Array(9).fill().map(() => Array(9).fill(0));
                
                // Fill diagonal boxes first
                for (let box = 0; box < 9; box += 3) {
                    this.fillBox(box, box);
                }
                
                // Fill remaining cells
                this.solveBoard();
            }
            
            fillBox(row, col) {
                const nums = [1,2,3,4,5,6,7,8,9];
                // Shuffle
                for (let i = nums.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [nums[i], nums[j]] = [nums[j], nums[i]];
                }
                
                let idx = 0;
                for (let i = 0; i < 3; i++) {
                    for (let j = 0; j < 3; j++) {
                        this.grid[row + i][col + j] = nums[idx++];
                    }
                }
            }
            
            solveBoard() {
                const findEmpty = () => {
                    for (let r = 0; r < 9; r++) {
                        for (let c = 0; c < 9; c++) {
                            if (this.grid[r][c] === 0) return [r, c];
                        }
                    }
                    return null;
                };
                
                const isValid = (num, row, col) => {
                    // Check row
                    for (let c = 0; c < 9; c++) {
                        if (this.grid[row][c] === num) return false;
                    }
                    
                    // Check column
                    for (let r = 0; r < 9; r++) {
                        if (this.grid[r][col] === num) return false;
                    }
                    
                    // Check 3x3 box
                    const boxRow = Math.floor(row / 3) * 3;
                    const boxCol = Math.floor(col / 3) * 3;
                    for (let r = 0; r < 3; r++) {
                        for (let c = 0; c < 3; c++) {
                            if (this.grid[boxRow + r][boxCol + c] === num) return false;
                        }
                    }
                    
                    return true;
                };
                
                const solve = () => {
                    const empty = findEmpty();
                    if (!empty) return true;
                    
                    const [row, col] = empty;
                    
                    // Try numbers 1-9 in random order
                    const nums = [1,2,3,4,5,6,7,8,9];
                    for (let i = nums.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [nums[i], nums[j]] = [nums[j], nums[i]];
                    }
                    
                    for (const num of nums) {
                        if (isValid(num, row, col)) {
                            this.grid[row][col] = num;
                            
                            if (solve()) {
                                return true;
                            }
                            
                            this.grid[row][col] = 0;
                        }
                    }
                    
                    return false;
                };
                
                return solve();
            }
            
            renderGrid() {
                const container = document.getElementById('sudokuGrid');
                container.innerHTML = '';
                
                for (let i = 0; i < 81; i++) {
                    const row = Math.floor(i / 9);
                    const col = i % 9;
                    const cellValue = this.userInput[row][col];
                    const originalValue = this.puzzle[row][col];
                    
                    const input = document.createElement('input');
                    input.type = 'number';
                    input.min = '1';
                    input.max = '9';
                    input.className = 'sudoku-cell';
                    
                    if (originalValue !== 0) {
                        // Given number (blue)
                        input.value = originalValue;
                        input.classList.add('given');
                        input.readOnly = true;
                    } else if (cellValue !== 0) {
                        // User entered number (black)
                        input.value = cellValue;
                        input.classList.add('user');
                    }
                    
                    // Add data attributes
                    input.dataset.row = row;
                    input.dataset.col = col;
                    
                    // Event listeners only for empty cells
                    if (originalValue === 0) {
                        input.addEventListener('input', (e) => {
                            const value = e.target.value;
                            const row = parseInt(e.target.dataset.row);
                            const col = parseInt(e.target.dataset.col);
                            
                            if (value >= 1 && value <= 9) {
                                const numValue = parseInt(value);
                                this.userInput[row][col] = numValue;
                                e.target.classList.remove('clue');
                                e.target.classList.add('user');
                            } else {
                                this.userInput[row][col] = 0;
                                e.target.classList.remove('user', 'clue');
                            }
                            
                            this.checkCompletion();
                            this.updateFilledCount();
                        });
                        
                        input.addEventListener('focus', (e) => {
                            if (!e.target.classList.contains('given')) {
                                e.target.style.backgroundColor = '#e6f7ff';
                            }
                        });
                        
                        input.addEventListener('blur', (e) => {
                            if (!e.target.classList.contains('given')) {
                                e.target.style.backgroundColor = '';
                            }
                        });
                    }
                    
                    container.appendChild(input);
                }
                
                this.updateFilledCount();
            }
            
            giveClue() {
                if (this.isSolved) return;
                
                // Find empty cells
                const emptyCells = [];
                for (let r = 0; r < 9; r++) {
                    for (let c = 0; c < 9; c++) {
                        if (this.puzzle[r][c] === 0 && this.userInput[r][c] === 0) {
                            emptyCells.push([r, c]);
                        }
                    }
                }
                
                if (emptyCells.length === 0) {
                    alert("All cells already filled!");
                    return;
                }
                
                // Pick random empty cell
                const [row, col] = emptyCells[Math.floor(Math.random() * emptyCells.length)];
                
                // Set to correct value
                this.userInput[row][col] = this.solution[row][col];
                
                // Update display
                const cellIndex = row * 9 + col;
                const cell = document.querySelectorAll('.sudoku-cell')[cellIndex];
                cell.value = this.solution[row][col];
                cell.classList.remove('user');
                cell.classList.add('clue');
                cell.readOnly = true;
                
                this.cluesUsed++;
                document.getElementById('cluesStat').textContent = this.cluesUsed;
                
                this.checkCompletion();
                this.updateFilledCount();
            }
            
            updateFilledCount() {
                let filledCount = 0;
                for (let r = 0; r < 9; r++) {
                    for (let c = 0; c < 9; c++) {
                        if (this.userInput[r][c] !== 0) {
                            filledCount++;
                        }
                    }
                }
                document.getElementById('filledStat').textContent = `${filledCount}/81`;
                return filledCount;
            }
            
            checkCompletion() {
                // Only show success message if ALL cells are correct AND solve button wasn't used
                if (this.usedSolveButton) return false;
                
                for (let r = 0; r < 9; r++) {
                    for (let c = 0; c < 9; c++) {
                        if (this.userInput[r][c] !== this.solution[r][c]) {
                            return false;
                        }
                    }
                }
                
                // All cells are correct and user didn't use solve button
                this.isSolved = true;
                this.stopTimer();
                this.showCompletionMessage();
                return true;
            }
            
            showCompletionMessage() {
                document.getElementById('finalTime').textContent = this.formatTime(this.timerSeconds);
                document.getElementById('finalClues').textContent = this.cluesUsed;
                document.getElementById('finalDifficulty').textContent = 
                    document.getElementById('difficulty').value.charAt(0).toUpperCase() + 
                    document.getElementById('difficulty').value.slice(1);
                document.getElementById('completionMessage').style.display = 'flex';
            }
            
            startTimer() {
                // Clear any existing timer
                this.stopTimer();
                
                // Start new timer
                this.timerInterval = setInterval(() => {
                    this.timerSeconds++;
                    this.updateTimerDisplay();
                }, 1000);
            }
            
            stopTimer() {
                if (this.timerInterval) {
                    clearInterval(this.timerInterval);
                    this.timerInterval = null;
                }
            }
            
            updateTimerDisplay() {
                const timeStr = this.formatTime(this.timerSeconds);
                document.getElementById('timer').textContent = timeStr;
            }
            
            formatTime(totalSeconds) {
                const minutes = Math.floor(totalSeconds / 60);
                const seconds = totalSeconds % 60;
                return `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            }
            
            updateStats() {
                const difficulty = document.getElementById('difficulty').value;
                const difficultyText = difficulty.charAt(0).toUpperCase() + difficulty.slice(1);
                document.getElementById('difficultyStat').textContent = difficultyText;
            }
            
            showSolution() {
                // Mark that user used solve button
                this.usedSolveButton = true;
                this.userInput = this.solution.map(row => [...row]);
                this.renderGrid();
                this.stopTimer();
                // Don't show completion message for solve button
            }
            
            refreshPuzzle() {
                // Reset user input to original puzzle (keep given numbers)
                this.userInput = this.puzzle.map(row => [...row]);
                this.renderGrid();
                // Reset clues used for current puzzle
                this.cluesUsed = 0;
                document.getElementById('cluesStat').textContent = '0';
                // Don't reset timer - user is still on same puzzle
                this.isSolved = false;
                this.usedSolveButton = false;
                this.updateFilledCount();
            }
            
            quitGame() {
                // Generate a completely new game
                this.generateNewPuzzle();
            }
            
            setupEventListeners() {
                document.getElementById('newBtn').addEventListener('click', () => {
                    this.quitGame();
                });
                
                document.getElementById('clueBtn').addEventListener('click', () => {
                    this.giveClue();
                });
                
                document.getElementById('solveBtn').addEventListener('click', () => {
                    if (confirm("Show complete solution? This will end your current game.")) {
                        this.showSolution();
                    }
                });
                
                document.getElementById('refreshBtn').addEventListener('click', () => {
                    if (confirm("Clear all your entries and start this puzzle again?")) {
                        this.refreshPuzzle();
                    }
                });
                
                document.getElementById('quitBtn').addEventListener('click', () => {
                    if (confirm("Quit current game and start a new one?")) {
                        this.quitGame();
                    }
                });
                
                document.getElementById('playAgainBtn').addEventListener('click', () => {
                    document.getElementById('completionMessage').style.display = 'none';
                    this.quitGame();
                });
                
                document.getElementById('difficulty').addEventListener('change', () => {
                    this.quitGame();
                });
            }
        }
        
        // Initialize game when page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.sudokuGame = new SudokuGame();
        });
    </script>
</body>
</html>